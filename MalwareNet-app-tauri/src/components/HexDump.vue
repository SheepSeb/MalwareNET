<script setup>
import { ref } from "vue";

let contents = ref("");
const path = ref("");

function handdleFile(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
        contents.value = e.target.result;
        createImg(e.target.result);
    };
    // Remove the \r\n from the end of each line
    reader.onloadend = (e) => {
        contents.value = contents.value.replace(/\r\n$/, "");
    };
    reader.readAsText(file);
}

function createImg(string_bytes){
    if(string_bytes == undefined){
        return;
    }
    // Remove the address from the beginning of each line
    let string_bytes_rep = string_bytes.replace(/^[0-9a-f]{8}:\s/, "");
    // Replace the ?? to 00
    string_bytes_rep = string_bytes_rep.replace(/\??/g, "00");
    let bytes = [];
    for (let i = 0; i < string_bytes_rep.length; i += 2) {
        bytes.push(parseInt(string_bytes_rep.substr(i, 2), 16));
    }

    // Create the bytes from the array
    let byteArray = new Uint8Array(bytes);

    // Trim the byteArray to size 256*256
    byteArray = byteArray.slice(0, 256*256);
    // Use canvas to create the image
    let canvas = document.createElement("canvas");
    canvas.width = 256;
    canvas.height = 256;
    let ctx = canvas.getContext("2d");
    let imgData = ctx.createImageData(256, 256);
    console.log(imgData.data)
    console.log(byteArray)
    imgData.data.set(byteArray);
    ctx.putImageData(imgData, 0, 0);
    // Create the image
    let img = new Image();
    img.src = canvas.toDataURL();
    // Make the background white
    img.style.backgroundColor = "white";
    // Add the image to the page
    document.body.appendChild(img);
}


</script>

<template>
    <!--Submit a file and upload it -->
    <div class="card">
        <input type="file" @change="handdleFile($event.target.files[0])" />
    </div>
    <!-- Display the contents of the file each line by line-->
    <!--It should have a scrollable object where the lines are displayed-->
    <div class="card">
        <!-- Inside it has a scrollbar -->
        <div class="scrollbar">
            <!-- Inside it has a pre tag -->
            <pre>{{ contents }}</pre>
        </div>
    </div>
</template>

<style scoped>
.scrollbar {
    overflow-y: scroll;
    height: 300px;
    width: 100%;
}
</style>